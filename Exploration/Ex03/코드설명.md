# 코드 설명

## 1. 스티커 위치 결정

`nose_tip = pts[33]
cx, cy = nose_tip`

- **pts[33]**: dlib의 68개 얼굴 랜드마크 중 33번은 **코 끝(nose tip)**
- **(cx, cy)**: 스티커의 중심점으로 사용할 좌표

---

## 2. 스티커 크기 계산

`face_width = rect.width()
face_height = rect.height()

sticker_width = int(face_width * 0.8)
sticker_height = int(sticker_width * (stk0.shape[0] / stk0.shape[1]))`

**왜 ?**

- `face_width * 0.8`: 얼굴 너비의 80%로 스티커 크기 결정 (비율 조정 가능)
- `stk0.shape[0] / stk0.shape[1]`: 원본 스티커의 **가로세로 비율** 유지
- **예시**: 얼굴 너비 200px → 스티커 너비 160px
    - 원본 스티커가 300x200 (높이x너비) 이면 비율 1.5
    - 스티커 높이 = 160 * 1.5 = 240px

---

## 3. 스티커 배치 좌표 계산

python

`left = cx - sticker_width // 2
top = cy - sticker_height // 2
```

**중심점(cx, cy)을 기준으로 스티커를 정중앙 배치**
```
       left          cx (중심)      right
         ↓             ↓              ↓
top  →   ┌─────────────┬─────────────┐
         │             │             │
         │             │             │
cy   →   ├─────────────●─────────────┤  ← 33번 랜드마크
         │             │             │
         │             │             │
bottom → └─────────────┴─────────────┘`

---

## 4. 스티커 리사이즈

`stk = cv2.resize(stk0, (sticker_width, sticker_height), 
                interpolation=cv2.INTER_AREA)`

- `stk0`: 원본 스티커 이미지 (한 번만 로드)
- `INTER_AREA`: 축소 시 모아레 패턴 방지, 고품질 리샘플링

---

## 5. 화면 경계 클리핑

`H, W = img_show.shape[:2]  *# 화면 크기 (예: 720x1280)*

y0 = max(0, top)           *# 상단이 화면 밖이면 0으로*
x0 = max(0, left)          *# 좌측이 화면 밖이면 0으로*
y1 = min(H, top + sticker_height)  *# 하단이 화면 밖이면 H로*
x1 = min(W, left + sticker_width)  *# 우측이 화면 밖이면 W로*
```

왜?
- 얼굴이 화면 가장자리에 있으면 스티커가 화면 밖으로 나갈 수 있음
- **배열 인덱스 오류** 방지

```
화면: 0 ~ 1280 (width)
스티커 left = -50 (화면 밖!)
  → x0 = max(0, -50) = 0 으로 보정`

---

## 6. 스티커 크롭

python

`sy0 = y0 - top    *# 스티커 시작 y 좌표*
sx0 = x0 - left   *# 스티커 시작 x 좌표*
sy1 = sy0 + (y1 - y0)  *# 스티커 끝 y 좌표*
sx1 = sx0 + (x1 - x0)  *# 스티커 끝 x 좌표*

stk_crop = stk[sy0:sy1, sx0:sx1]
roi = img_show[y0:y1, x0:x1]
```

**좌표계 변환**
```
화면 좌표계           스티커 좌표계
(x0, y0)             (sx0, sy0)
    ↓                    ↓
┌───────────┐       ┌───────────┐
│ 화면      │       │ 스티커    │
│    ■■■■  │  →    │ ■■■■     │
│           │       │           │
└───────────┘       └───────────┘
(x1, y1)             (sx1, sy1)`
