# 학습 결과 요약 

## 1. 증강 없음 (No Augmentation)
**경로:** `checkpoints_noaug`  
**설명:** 데이터 증강을 전혀 적용하지 않은 상태입니다.

![No Augmentation Training Curves](c:/Users/C/Desktop/detec/checkpoints_noaug/no_aug_training_curves.png)

---

## 2. 약한 증강 (Small Augmentation)
**경로:** `checkpoints_small_aug`  
**설명:** 약한 강도의 데이터 증강을 적용했습니다.

![Small Augmentation Training Curves](c:/Users/C/Desktop/detec/checkpoints_small_aug/training_curves_SMALLAUG.png)

---

## 3. 강한 증강 (Hard Augmentation)
**경로:** `checkpoints_hardaug`  
**설명:** 강한 강도의 데이터 증강을 적용했습니다.

![Hard Augmentation Training Curves](c:/Users/C/Desktop/detec/checkpoints_hardaug/training_curves_HARDAUG.png)

---

## 4. 가장 강한 증강 (Strongest Augmentation)
**경로:** `checkpoints`  
**설명:** 가장 강한 강도의 데이터 증강을 적용했습니다.

![Strongest Augmentation Training Curves](c:/Users/C/Desktop/detec/checkpoints/training_curves.png)

---

## 5. 벤치마크 결과

### 5.1 성능 지표

| Model | mAP@0.5 | Easy AP | Medium AP | Hard AP | Small AP | Medium AP (Size) | Large AP |
|-------|---------|---------|-----------|---------|----------|------------------|----------|
| No Aug | 0.0415 | 0.2010 | 0.0126 | 0.0009 | 0.0033 | 0.0866 | 0.3071 |
| Small Aug | **0.0453** | **0.2304** | **0.0130** | 0.0007 | 0.0026 | **0.1146** | **0.3297** |
| Hard Aug | 0.0327 | 0.1776 | 0.0072 | 0.0005 | 0.0016 | 0.0652 | 0.3097 |
| Strongest Aug | 0.0412 | 0.2097 | 0.0119 | 0.0006 | 0.0025 | 0.0959 | 0.3136 |

**결론:** **Small Aug** 모델이 전반적으로 가장 우수한 성능을 보입니다.

---

## 6. 성능 분석: mAP가 낮은 이유

현재 **mAP@0.5: 4~4.5%**로 낮은 성능을 보이고 있습니다. 이는 다음과 같은 **기술적 한계**에 기인합니다.

### 6.1 입력 해상도 문제 (320×256) ⭐⭐⭐

**문제:**
- WIDER FACE 데이터셋은 **매우 작은 얼굴(4×4 픽셀)**이 다수 포함되어 있습니다.
- 원본 이미지(예: 1024×678)를 320×256으로 리사이즈하면, 4픽셀 얼굴이 약 **1.2픽셀**로 축소됩니다.
- 1.2픽셀 크기의 얼굴은 사실상 **특징 추출이 불가능**합니다.

**증거:**
- **Hard AP(bbox height ≤ 25px): 0.05~0.09%** ← 사실상 감지 실패
- **Small AP(shorter side < 32px): 0.16~0.33%** ← 거의 감지 못함
- **Large AP(shorter side > 96px): 30.7~32.9%** ← 큰 얼굴은 정상 감지

> **💡 해결 방안:** 입력 해상도를 **640×640** 이상으로 증가시키면 Hard/Small AP가 크게 향상될 것으로 예상됩니다.

---

### 6.2 Anchor Box (Default Box) 스케일 불일치 ⭐⭐

**현재 설정:**
```python
BOX_MIN_SIZES = [[10, 16, 24], [32, 48], [64, 96], [128, 192, 256]]
# 320×256 입력 기준
# 가장 작은 anchor: 10 픽셀 → 원본 이미지 약 32 픽셀
```

**문제:**
- 가장 작은 anchor(10px)는 원본 이미지에서 약 **32픽셀**에 해당합니다.
- GT에는 **4×4 픽셀** 수준의 얼굴이 많습니다.
- **Anchor보다 작은 얼굴은 원리적으로 감지 불가능**합니다.

> **💡 해결 방안:** `BOX_MIN_SIZES`에 더 작은 크기(예: `[4, 6, 8]`)를 추가하면 작은 얼굴 감지 능력이 향상될 수 있습니다.

---

### 6.3 Feature Map Stride의 구조적 한계 ⭐⭐

**현재 모델 구조:**
```python
# model.py
Feature Maps: stride 8, 16, 32, 64
# 가장 작은 stride = 8
```

**문제:**
- Stride 8의 feature map에서 **1픽셀은 원본 이미지의 8×8 픽셀 영역**을 대표합니다.
- 4×4 픽셀 얼굴은 feature map에서 **0.5×0.5 픽셀** 미만입니다.
- **1픽셀도 차지하지 못하는 물체는 감지 불가능**합니다.

**비교:**
| 얼굴 크기 (원본) | Feature Map (Stride 8) | 감지 가능 여부 |
|------------------|------------------------|----------------|
| 4×4 px | 0.5×0.5 px | ❌ 불가능 |
| 16×16 px | 2×2 px | ⚠️ 어려움 |
| 32×32 px | 4×4 px | ✅ 가능 |

> **💡 해결 방안:** Stride를 더 줄이거나(예: 4), FPN(Feature Pyramid Network) 같은 multi-scale 구조를 도입하면 개선 가능합니다.

---

### 6.4 WIDER FACE 데이터셋의 고난이도 ⭐

WIDER FACE는 **가장 어려운 얼굴 감지 데이터셋** 중 하나입니다:
- 군중 속 작은 얼굴
- 심한 가려짐 (occlusion)
- 극단적인 각도 및 조명
- 저해상도 이미지

**SOTA 모델과 비교:**
- RetinaFace (2020): Easy 96.9%, Medium **95.0%**, Hard **90.8%**
- 우리 모델: Easy 23.0%, Medium 1.3%, Hard **0.07%**

> **결론:** 현재 성능이 SOTA에 비해 낮은 것은 맞지만, **입력 해상도와 모델 구조**를 고려하면 예상 가능한 수준입니다.

---

### 6.5 데이터 증강의 효과 분석 ⭐

**관찰:**
- **Small Aug**가 가장 좋은 성능 (mAP 4.53%)
- **Hard/Strongest Aug**는 오히려 성능 저하 (mAP 3.27%, 4.12%)

**해석:**
- **너무 강한 증강(blur, noise, erasing)**은 작은 얼굴의 특징을 더욱 훼손시킵니다.
- 작은 얼굴에 blur를 적용하면 완전히 뭉개져서 학습이 어려워집니다.
- **적당한 증강**이 일반화(generalization)에 가장 효과적입니다.

---

## 7. 종합 결론 및 개선 방향

### 7.1 현재 상황
✅ **모델은 정상적으로 학습됨** (Easy 23%, Large 33% 달성)  
❌ **작은 얼굴 감지 실패** (Hard 0.07%, Small 0.26%)

### 7.2 성능 향상을 위한 우선순위

1. **입력 해상도 증가 (가장 효과적)** ⭐⭐⭐
   - 320×256 → **640×640** 또는 **800×600**
   - 예상 효과: Hard AP 0.07% → **2~5%**, mAP 4% → **10~15%**

2. **작은 Anchor 추가** ⭐⭐
   - `BOX_MIN_SIZES`에 `[4, 6, 8]` 추가
   - 예상 효과: Small AP 0.26% → **1~2%**

3. **모델 구조 개선** ⭐
   - FPN(Feature Pyramid Network) 도입
   - Stride 4 feature map 추가
   - 예상 효과: 전반적인 Recall 향상

4. **데이터 증강 최적화** ⭐
   - Small Aug 수준 유지 (이미 최적)
   - Scale augmentation 강화 (작은 얼굴 비율 증가)

### 7.3 실용적 관점
- **Easy/Large 셋에서 20~30% 달성**은 실제 응용(예: 웹캠 얼굴 감지)에서는 **충분히 사용 가능**한 수준입니다.
- 군중 속 4픽셀 얼굴을 감지해야 하는 경우가 아니라면, 현재 모델로도 실용성이 있습니다.
- **`realtime.py`로 웹캠 테스트 시 일반적인 거리(50~100cm)의 얼굴은 잘 감지됩니다.**
